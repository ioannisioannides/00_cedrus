# ==============================================================================
# PYTEST CONFIGURATION
# ==============================================================================
# Configured by: Dr. Priya Sharma (Harvard PhD, QA Director, 22 years)
# Enterprise Excellence Initiative - Week 1, Day 3-4
# ==============================================================================

[pytest]
# Django settings module for testing
DJANGO_SETTINGS_MODULE = cedrus.settings

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Additional options for pytest
addopts = 
    # Database optimization
    --reuse-db
    # Traceback format (short, line, long, or native)
    --tb=short
    # Stop after N failures (prevents cascading failures)
    --maxfail=5
    # Strict marker checking (fail on unknown markers)
    --strict-markers
    # Disable warnings summary (cleaner output)
    -p no:warnings
    # Coverage configuration
    --cov=accounts
    --cov=audits
    --cov=core
    --cov=trunk
    --cov=reporting
    --cov=cedrus
    --cov-report=html
    --cov-report=term-missing
    --cov-report=xml
    # Fail if coverage is below threshold
    --cov-fail-under=75
    # Verbose output
    --verbose
    # Show local variables in tracebacks
    --showlocals
    # Display test durations (slowest 10)
    --durations=10

# Test markers for selective test execution
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    security: marks tests as security tests
    performance: marks tests as performance tests
    smoke: marks tests as smoke tests (quick validation)
    django_db: marks tests that require database access
    
# Minimum Python version
minversion = 3.13

# Test paths (where to look for tests)
testpaths = 
    accounts/tests.py
    audits/
    core/tests.py
    reporting/tests.py
    trunk/tests.py

# Console output style
console_output_style = progress

# Live logging (helpful for debugging)
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# File logging
log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# ==============================================================================
# USAGE EXAMPLES
# ==============================================================================
# Run all tests:
#   pytest
#
# Run specific app tests:
#   pytest audits/
#
# Run with coverage report:
#   pytest --cov-report=html
#
# Run only unit tests (fast):
#   pytest -m unit
#
# Run excluding slow tests:
#   pytest -m "not slow"
#
# Run with live logging:
#   pytest --log-cli-level=DEBUG
#
# Parallel execution (requires pytest-xdist):
#   pytest -n auto
#
# Stop on first failure:
#   pytest -x
#
# Re-run last failures:
#   pytest --lf
# ==============================================================================

# ==============================================================================
# QUALITY STANDARDS
# ==============================================================================
# Target: 100% test pass rate
# Target: 75% minimum code coverage (enforced)
# Target: 90% goal code coverage
# Target: <1s per unit test
# Target: <10s per integration test
# ==============================================================================
